{% extends 'base.html' %}
{% load static %}

{% block title %}{{ titulo }}{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="row">
        <div class="col-md-8 offset-md-2">
            <!-- Encabezado -->
            <div class="mb-4">
                <h1 class="display-6">{{ titulo }}</h1>
                <p class="lead text-muted">{{ valvula.marca }} {{ valvula.modelo }} | S/N: {{ valvula.numero_serie }}</p>
            </div>

            <!-- Mensajes -->
            {% if messages %}
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                {% endfor %}
            {% endif %}

            <!-- Formulario -->
            <div class="card shadow-sm mb-4">
                <div class="card-body p-4">
                    <form method="POST">
                        {% csrf_token %}

                        <!-- Información Ubicación -->
                        <fieldset class="mb-4">
                            <legend class="h5 mb-3" style="color: #1e40af; border-bottom: 2px solid #1e40af; padding-bottom: 10px;">
                                Información de Ubicación
                            </legend>

                            <!-- TAG -->
                            <div class="mb-3">
                                <label for="{{ form.tag_localizacion.id_for_label }}" class="form-label">
                                    <strong>TAG/Identificador</strong>
                                </label>
                                {{ form.tag_localizacion }}
                                {% if form.tag_localizacion.errors %}
                                    <div class="text-danger mt-1">{{ form.tag_localizacion.errors }}</div>
                                {% endif %}
                                <small class="form-text text-muted d-block mt-1">
                                    {{ form.tag_localizacion.help_text }}
                                </small>
                            </div>

                            <!-- Ubicación Física -->
                            <div class="mb-3">
                                <label for="{{ form.ubicacion.id_for_label }}" class="form-label">
                                    <strong>Ubicación Física</strong>
                                </label>
                                {{ form.ubicacion }}
                                {% if form.ubicacion.errors %}
                                    <div class="text-danger mt-1">{{ form.ubicacion.errors }}</div>
                                {% endif %}
                                <small class="form-text text-muted d-block mt-1">
                                    {{ form.ubicacion.help_text }}
                                </small>
                            </div>
                        </fieldset>

                        <!-- Especificaciones Técnicas (solo lectura) -->
                        <fieldset class="mb-4">
                            <legend class="h5 mb-3" style="color: #666; border-bottom: 2px solid #ddd; padding-bottom: 10px;">
                                Especificaciones Técnicas <small class="text-muted">(Se actualizan automáticamente)</small>
                            </legend>

                            <!-- Presión SET -->
                            <div class="mb-3">
                                <label for="{{ form.presion_set.id_for_label }}" class="form-label">
                                    <strong>Presión SET</strong>
                                </label>
                                {{ form.presion_set }}
                                <small class="form-text text-muted d-block mt-1">
                                    Este campo se actualiza automáticamente cuando se suben documentos con esta información
                                </small>
                            </div>

                            <!-- Norma Aplicable -->
                            <div class="mb-3">
                                <label for="{{ form.norma_aplicable.id_for_label }}" class="form-label">
                                    <strong>Norma Aplicable</strong>
                                </label>
                                {{ form.norma_aplicable }}
                                <small class="form-text text-muted d-block mt-1">
                                    Este campo se actualiza automáticamente cuando se suben documentos con esta información
                                </small>
                            </div>
                        </fieldset>

                        <!-- Estado y Observaciones -->
                        <fieldset class="mb-4">
                            <legend class="h5 mb-3" style="color: #1e40af; border-bottom: 2px solid #1e40af; padding-bottom: 10px;">
                                Estado y Observaciones
                            </legend>

                            <!-- Estado -->
                            <div class="mb-3">
                                <label for="{{ form.estado.id_for_label }}" class="form-label">
                                    <strong>Estado de la Válvula</strong>
                                </label>
                                {{ form.estado }}
                                {% if form.estado.errors %}
                                    <div class="text-danger mt-1">{{ form.estado.errors }}</div>
                                {% endif %}
                            </div>

                            <!-- Observaciones -->
                            <div class="mb-3">
                                <label for="{{ form.observaciones.id_for_label }}" class="form-label">
                                    <strong>Observaciones</strong>
                                </label>
                                {{ form.observaciones }}
                                {% if form.observaciones.errors %}
                                    <div class="text-danger mt-1">{{ form.observaciones.errors }}</div>
                                {% endif %}
                                <small class="form-text text-muted d-block mt-1">
                                    {{ form.observaciones.help_text }}
                                </small>
                            </div>
                        </fieldset>

                        <!-- Botones -->
                        <div class="d-flex gap-2 mt-4">
                            <button type="submit" class="btn btn-primary btn-lg">
                                <i class="fas fa-save"></i> Guardar Cambios
                            </button>
                            <a href="{% url 'valvulas:hoja_vida' valvula.id %}" class="btn btn-secondary btn-lg">
                                <i class="fas fa-times"></i> Cancelar
                            </a>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Información de ayuda -->
            <div class="alert alert-info" role="alert">
                <h6 class="alert-heading">
                    <i class="fas fa-lightbulb"></i> Nota Importante
                </h6>
                <p class="mb-0">
                    <strong>Presión SET y Norma Aplicable</strong> Se actualizan automáticamente cuando subes documentos 
                    (certificados de calibración, informes de mantenimiento) que contienen esta información. 
                    Estos campos están protegidos para mantener la integridad de los datos extraídos.
                </p>
            </div>
        </div>
    </div>
</div>

<style>
    .form-control, .form-select {
        border-color: #ddd;
        padding: 0.625rem 0.75rem;
    }
    
    .form-control:focus, .form-select:focus {
        border-color: #1e40af;
        box-shadow: 0 0 0 0.2rem rgba(30, 64, 175, 0.25);
    }
    
    fieldset {
        border: 1px solid #eee;
        border-radius: 0.25rem;
        padding: 1rem;
    }
    
    legend {
        width: auto;
        margin-bottom: 0;
    }
    
    .form-text {
        font-size: 0.875rem;
    }
</style>
{% endblock %}
